<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cloud No.7 — 구매하기</title>
  <meta name="description" content="Cloud No.7 구매 알림 등록 — 이메일을 남기면 한정 넘버링 Founders Batch 소식을 가장 먼저 전해드립니다.">
  <meta name="theme-color" content="#F5F2EE">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#F5F2EE; --ink:#1e2430; --muted:#6b7280; --accent:#0ea5e9;
      --card:#ffffffd9; --radius:24px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);
      font-family:'Pretendard', system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans KR',sans-serif; line-height:1.6}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .nav{position:fixed; inset:0 0 auto 0; height:68px; z-index:50;
      display:flex; align-items:center; justify-content:space-between; padding:0 20px;
      background:linear-gradient(180deg, rgba(245,242,238,.85), rgba(245,242,238,0));
      backdrop-filter:saturate(180%) blur(8px);
    }
    .brand{display:flex; gap:10px; align-items:center}
    .logo{height:34px;}
    .brand h1{font:600 18px/1 'Playfair Display',serif; margin:0}
    .nav a.btn{padding:10px 16px; border-radius:999px; border:1px solid #c7d2fe; background:#fff; font-weight:600}
    .wrap{min-height:100vh; display:flex; flex-direction:column;}
    .hero{
      position:relative; display:grid; place-items:center; padding:90px 20px 60px;
      text-align:center;
      flex-grow: 1;
      overflow: hidden;
    }
    .sky{
      position:absolute; inset:-2rem -2rem 0 -2rem; z-index:-2;
      background:
        linear-gradient(180deg, rgba(255,255,255,.9) 0%, rgba(245,242,238,.6) 25%, rgba(245,242,238,.95) 100%),
        url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1600&auto=format&fit=crop');
      background-size:cover; background-position:center 35%;
      filter:saturate(105%) contrast(102%);
    }
    .card{
      max-width:720px; width:100%;
      background:var(--card); padding:28px; border-radius:var(--radius);
      box-shadow:0 22px 60px rgba(0,0,0,.08);
      backdrop-filter: blur(6px);
      text-align:left;
    }
    .h2{font:600 clamp(28px,4.6vw,44px)/1.15 'Playfair Display',serif; margin:0 0 10px}
    .muted{color:var(--muted)}
    form{display:grid; gap:16px; margin-top:12px}
    .field{display:grid; gap:8px}
    label{font-weight:600; font-size:14px}
    input[type="email"], input[type="text"]{
      padding:14px 16px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; font-size:16px;
      outline: none; transition:border .2s ease, box-shadow .2s ease;
    }
    input[type="email"]:focus, input[type="text"]:focus{border-color:#bfdbfe; box-shadow:0 0 0 6px rgba(191,219,254,.35)}
    .consent{display:flex; gap:10px; align-items:flex-start; font-size:14px; color:#475569}
    .cta{display:inline-flex; align-items:center; gap:10px; justify-content:center;
      padding:14px 22px; border-radius:999px; background:#111827; color:#fff; font-weight:700;
      box-shadow:0 18px 35px rgba(17,24,39,.25); border:none; cursor:pointer}
    .cta:hover{transform:translateY(-1px)}
    .note{font-size:12px; color:#64748b}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    @media (max-width:720px){ .row{grid-template-columns:1fr} .card{padding:22px} }
    .success{display:none; background:#e6f9ee; border:1px solid #86efac; color:#065f46; padding:12px 14px; border-radius:12px; font-size:14px}
    .error{display:none; background:#fff2f2; border:1px solid #fecaca; color:#7f1d1d; padding:12px 14px; border-radius:12px; font-size:14px}
    footer{padding:40px 20px 60px; text-align:center; color:#64748b}
  </style>
</head>
<body>
<div class="wrap">
  <header class="nav" role="navigation" aria-label="주요 메뉴">
    <div class="brand">
      <img src="logo_b.png" alt="Cloud No.7 Logo" class="logo">
    </div>
    <nav><a class="btn" href="cloud_no7_index.html">홈으로</a></nav>
  </header>

  <main class="hero">
    <div class="sky" aria-hidden="true"></div>
    <div class="card" role="region" aria-label="구매 알림 등록 카드">
      <div class="h2">구매하기</div>
      <p class="muted">이메일을 남겨주시면 일곱번째 한정 넘버링 구름을 보내드립니다.<br>구매 후 2~3일의 배송 기간이 소요됩니다.</p>

      <div id="msg-success" class="success" role="status">등록되었습니다. 곧 하늘에서 소식을 전할게요 ☁︎</div>
      <div id="msg-error" class="error" role="alert">전송에 실패했습니다. 이메일 형식과 동의 항목을 확인해주세요.</div>
      <div id="msg-limit-error" class="error" role="alert">3회까지만 구매 가능합니다.</div>

      <form id="subscribe-form" method="POST" action="/subscribe" novalidate>
        <div class="field">
          <label for="email">이메일</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required />
        </div>

        <div class="row">
          <div class="field">
            <label for="name">이름(선택)</label>
            <input id="name" name="name" type="text" placeholder="홍길동" />
          </div>
          <div class="field">
            <label for="ref">추천 코드(선택)</label>
            <input id="ref" name="ref" type="text" placeholder="예: SKY07" />
          </div>
        </div>

        <!-- Hidden tracking fields -->
        <input type="hidden" id="utm_source" name="utm_source">
        <input type="hidden" id="utm_campaign" name="utm_campaign">
        <input type="hidden" id="utm_medium" name="utm_medium">
        <input type="hidden" id="utm_content" name="utm_content">

        <label class="consent">
          <input type="checkbox" id="agree" required>
          <span>이메일 수신에 동의합니다.</span>
        </label>

        <button class="cta" type="submit" aria-label="이메일 등록">일곱번째 구름 구매하기</button>
        <div class="note">제출 시 <strong>개인정보 처리방침</strong>에 동의한 것으로 간주됩니다. 실제 결제는 추후 안내됩니다.</div>
      </form>
    </div>
  </main>

  <footer>
    © <span id="year"></span> Cloud No.7 — Born in the Sky, Kept for You.
    <div class="note"></div>
  </footer>
</div>

<script>
  // Year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Populate UTM hidden fields
  const params = new URLSearchParams(location.search);
  ['utm_source','utm_campaign','utm_medium','utm_content'].forEach(k=>{
    const el = document.getElementById(k);
    if(el) el.value = params.get(k) || '';
  });

  // Show server-side errors if redirected
  if (params.get('error') === 'limit_reached') {
    const limitErr = document.getElementById('msg-limit-error');
    if(limitErr) limitErr.style.display = 'block';
  }

  // Front-end validation + graceful fallback
  const form = document.getElementById('subscribe-form');
  const ok = document.getElementById('msg-success');
  const err = document.getElementById('msg-error');

  form.addEventListener('submit', (e)=>{
    const email = document.getElementById('email').value.trim();
    const agree = document.getElementById('agree').checked;
    if(!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email) || !agree){
      e.preventDefault();
      err.style.display='block'; ok.style.display='none';
      return;
    }
    if(params.get('demo') === 'true'){
      e.preventDefault();
      const payload = {
        email,
        name: document.getElementById('name').value.trim(),
        ref: document.getElementById('ref').value.trim(),
        utm_source: document.getElementById('utm_source').value,
        utm_campaign: document.getElementById('utm_campaign').value,
        utm_medium: document.getElementById('utm_medium').value,
        utm_content: document.getElementById('utm_content').value,
        ts: new Date().toISOString()
      };
      const key = 'cloudno7_subscribers';
      const existing = JSON.parse(localStorage.getItem(key) || '[]');
      existing.push(payload);
      localStorage.setItem(key, JSON.stringify(existing));
      ok.style.display='block'; err.style.display='none';
      form.reset();
    }
  });
</script>
</body>
</html>
