# 프로젝트 기술 요약 (For Handover)

## 1. 프로젝트 개요
- **게임명**: 설득의 신
- **장르**: 2D 4방향 경영/설득 시뮬레이션
- **기술 스택**: Vanilla JavaScript (ES Modules), HTML5, CSS
- **실행 방법**: `index.html` 파일을 웹 브라우저에서 열기

## 2. 주요 파일 구조 및 역할
- `index.html`: 모든 UI 요소와 게임 컨테이너를 포함하는 메인 HTML.
- `style.css`: 게임의 모든 시각적 스타일을 담당.
- `js/main.js`: 게임의 메인 루프, 상태 관리(`gameState`), 모든 모듈을 총괄하는 핵심 파일.
- `js/constants.js`: 게임의 주요 설정값(속도, 시간)과 핵심 데이터(직업, 대화, 업적)를 정의.
- `js/player.js`, `npc.js`, `hud.js`, `dialogue.js`, `achievements.js` 등: 각 기능별로 분리된 모듈.

## 3. 핵심 아키텍처
- **상태 관리**: 모든 게임 데이터는 `main.js`의 `gameState` 객체 하나로 관리됨.
- **게임 루프**: `main.js`의 `gameLoop` 함수가 `requestAnimationFrame`을 통해 계속 실행되며, `isPaused` 플래그로 루프의 동작을 제어.
- **이벤트 기반**: `dayend`와 같은 주요 상태 변경은 `window.dispatchEvent`를 사용한 커스텀 이벤트를 통해 전파됨.
- **모듈 시스템**: 모든 JavaScript 파일은 ES 모듈(`import`/`export`)을 사용하여 서로의 기능을 호출함.

---

# 설득의 신 - 개발 히스토리

## 1. 초기 기획 및 프로토타입 (v0.1)
- **기본 설정**
    - `build.md` 기획서 기반으로 개발 목표 설정.
    - HTML, CSS, JavaScript를 사용한 웹 기반 프로토타입으로 결정.
- **모바일 최적화**
    - 9:16 화면 비율의 UI 컨테이너 구현.
    - 터치 조작을 위한 가상 D-패드 및 액션 버튼 UI 추가.
- **코드 구조**
    - 유지보수를 위해 JavaScript 코드를 기능별 모듈로 분리 (`main.js`, `player.js`, `npc.js` 등).

## 2. 핵심 게임플레이 구현 (v0.2)
- **주민(NPC) 시스템**
    - NPC가 화면 상단에서 아래로 내려오도록 구현.
    - GDD에 명시된 직업(농사꾼, 암살자 등)을 무작위로 부여.
    - '몰락한 왕'을 제외한 직업에 남/여 성별을 50% 확률로 부여.
    - 직업별 등장 확률을 가중치에 따라 다르게 설정 (몰락한 왕 3%, 암살자 8% 등).
- **상호작용 시스템**
    - 플레이어와 NPC 간의 충돌 감지 기능 구현.
    - **대화 시스템**: 상호작용 시 NPC의 직업과 성별에 따라 다른 대사가 출력되는 대화창 구현.
    - **설득 미니게임**: 대화 이후, 타이밍 맞추기 방식의 미니게임을 진행하여 성공/실패를 판정.
- **경제 및 성장 시스템**
    - NPC 영입 성공 시 인구 수만 즉시 증가.
    - 재력, 토지 등 핵심 자원은 '하루 결산' 시점에 영입한 모든 주민의 직업 효과를 합산하여 일괄 반영.

## 3. 게임 루프 및 엔딩 (v0.3)
- **하루 주기 시스템**
    - 테스트를 위해 하루의 길이를 10초로 설정.
    - 시간 종료 시 '하루 결산' 팝업창 표시, 게임 일시정지.
    - 결산 창에 일일 자원 변화량 및 현재 직업 구성 표시.
    - '다음 날로' 버튼을 통해 다음 날 시작.
- **게임오버 조건**
    - 자원(재력, 토지, 무력, 행복도) 중 하나라도 0 이하가 되면 게임오버.
    - (특수) 15일 이후 인구가 0명이면 '외로운 종말' 게임오버.
    - (특수) 자원 고갈 시, 암살자를 보유하고 있으면 '암살자의 밤' 특수 게임오버.
- **멀티 엔딩 시스템**
    - 15일차에 '왕의 등장' 이벤트 발생.
    - **A엔딩**: '평화' 선택 시 달성.
    - **B엔딩**: '전쟁' 선택 시, 조건에 따라 승리/패배 분기.
        - 승리 조건 1: 무사 5명 이상 + 무력 60 이상.
        - 승리 조건 2: 주민 모두가 암살자 + 암살자 3명 이상 (그림자 군주 엔딩).
    - **C엔딩 (진엔딩)**: '내가 왕이다' 선택 시 '왕의 방'으로 이동, 8명의 신하와 모두 대화하면 달성.

## 4. 추가 시스템 및 UX (v0.4)
- **업적 시스템**
    - `up.txt` 기반 및 추가 아이디어를 포함한 20개 이상의 업적 데이터 정의.
    - 업적 목록 확인 UI 및 달성 시 토스트 알림 기능 구현.
    - '숨겨진 업적'은 달성 전까지 조건이 보이지 않도록 처리.
- **UI/UX 개선 및 버그 수정**
    - 다수의 레이아웃 문제 해결 (UI 중앙 정렬, 화면 비율 유지, 요소 겹침 및 사라짐 현상 수정).
    - 다수의 JavaScript 오류 해결 (문법 오류, 참조 오류, 로직 오류로 인한 게임 멈춤 현상 수정).
    - 상태 관리 개선 (결산 시점에 진행 중이던 상호작용이 취소되도록 수정).

---

## TODO

- [ ] **저장하기 / 불러오기 기능 구현**
    - '다음 날로' 버튼 클릭 시 `localStorage`에 게임 상태 자동 저장.
    - 게임 시작 시 '이어하기' / '새로 시작' 버튼 제공.
